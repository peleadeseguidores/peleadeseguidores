<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>@PELEA DE SEGUIDORES</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, #f5f6fb 0%, #e1e6f7 100%);
      font-family: 'Segoe UI', system-ui, sans-serif;
      color: #22223b;
      -webkit-tap-highlight-color: transparent;
    }
    .wrap {
      max-width: 500px;
      margin: 0 auto;
      padding: 20px 8px 40px 8px;
    }
    .title-bar {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 18px;
      margin-top: 32px;
    }
    h1 {
      margin: 0;
      font-size: 2.1rem;
      line-height: 1.18;
      letter-spacing: 1px;
      font-family: 'Segoe UI Semibold', 'Segoe UI', system-ui, sans-serif;
      color: #22223b;
      text-shadow: 0 2px 7px #00000011;
      user-select: none;
      text-align: center;
    }
    .sword {
      width: 29px;
      height: 29px;
      flex-shrink: 0;
      filter: drop-shadow(0 1.5px 3px #0002);
      opacity: 0.9;
      transition: transform 0.3s;
      display: block;
    }
    .sword.left { transform: rotate(-17deg) scaleX(-1); }
    .sword.right { transform: rotate(17deg); }
    .counter {
      text-align: center;
      color: #4b5563;
      font-size: 1.08rem;
      margin-bottom: 22px;
      font-weight: 600;
      letter-spacing: 0.5px;
      background: #fff8;
      border-radius: 12px;
      padding: 7px 0 6px 0;
      box-shadow: 0 3px 7px #0001;
      border: 1px solid #e0e7ef;
      width: 87%;
      margin-left: auto;
      margin-right: auto;
      margin-bottom: 25px;
    }
    .card {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 14px;
      padding: 18px 7vw 15px 7vw;
      box-shadow: 0 6px 22px #0001;
      margin-bottom: 27px;
    }
    form {
      display: grid;
      gap: 13px;
      max-width: 99vw;
      margin: 0 auto;
    }
    input[type=text],input[type=file] {
      width: 100%;
      padding: 0 12px;
      height: 44px;
      border: 1.2px solid #c9d2e3;
      border-radius: 10px;
      font-size: 17px;
      background: #f7f9fd;
      box-shadow: 0 2px 6px #0000;
      transition: border-color 0.2s;
    }
    input[type=text]:focus,input[type=file]:focus {
      border-color: #7c3aed;
      outline: none;
    }
    button {
      height: 46px;
      border: 0;
      background: linear-gradient(90deg,#7c3aed 20%,#22c55e 85%);
      color: #fff;
      border-radius: 11px;
      font-weight: 700;
      font-size: 17px;
      cursor: pointer;
      letter-spacing: 0.5px;
      box-shadow: 0 2px 8px #7c3aed16;
      transition: background 0.2s, box-shadow 0.2s;
    }
    button:disabled {
      opacity: .7;
      cursor: not-allowed;
    }
    .msg {
      min-height: 20px;
      font-size: 15px;
      text-align: center;
      margin-top: 1.5px;
      font-weight: 500;
      letter-spacing: 0.2px;
      color: #374151;
    }
    @media (max-width:430px) {
      h1 { font-size: 1.17rem; }
      .wrap { padding: 5px 1.5vw 15vw 1.5vw; }
      .sword { width: 19px; height: 19px; }
      .card { padding: 10px 2vw 8px 2vw; }
      .counter { font-size: 0.98rem; width: 99%; }
      button { font-size: 15.7px; height: 41px; }
      input[type=text],input[type=file] { font-size:15px; height:38px; }
    }
    @media (max-width:340px) {
      .wrap { padding: 0 0 6vw 0; }
      .counter { font-size: 0.93rem; }
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="title-bar">
    <!-- SVG Espada Izquierda -->
    <svg class="sword left" viewBox="0 0 64 64">
      <g>
        <rect x="29" y="6" width="6" height="38" rx="3" fill="#d1d5db" stroke="#8b5c2e" stroke-width="1.2"/>
        <rect x="24" y="42" width="16" height="7" rx="2.5" fill="#fbbf24" stroke="#b45309" stroke-width="1.2"/>
        <rect x="30.5" y="48" width="3" height="9" rx="1.5" fill="#7c3aed"/>
        <ellipse cx="32" cy="54.5" rx="7" ry="3" fill="#7c3aed" opacity="0.25"/>
      </g>
    </svg>
    <h1>@PELEA DE SEGUIDORES</h1>
    <!-- SVG Espada Derecha -->
    <svg class="sword right" viewBox="0 0 64 64">
      <g>
        <rect x="29" y="6" width="6" height="38" rx="3" fill="#d1d5db" stroke="#8b5c2e" stroke-width="1.2"/>
        <rect x="24" y="42" width="16" height="7" rx="2.5" fill="#fbbf24" stroke="#b45309" stroke-width="1.2"/>
        <rect x="30.5" y="48" width="3" height="9" rx="1.5" fill="#7c3aed"/>
        <ellipse cx="32" cy="54.5" rx="7" ry="3" fill="#7c3aed" opacity="0.25"/>
      </g>
    </svg>
  </div>
  <div class="counter">Total de jugadores: <span id="total">827</span></div>
  <div class="card">
    <form id="form">
      <input id="nombre" type="text" placeholder="Usuario de Instagram (ej: @usuario)" required autocomplete="off" autocapitalize="off"/>
      <input id="foto" type="file" accept="image/*" required />
      <button id="btn" type="submit">Registrar</button>
      <div id="msg" class="msg"></div>
    </form>
  </div>
</div>
<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzeSlPx10-dm2p2wllLTz4nxB-xvlcOAdG5iK3AMj-wqKyJdlMdyaKEgLfHYdUMyZ5T/exec";
const BASE_CONTADOR = 827;
const totalEl = document.querySelector("#total");
const form = document.querySelector("#form");
const btn = document.querySelector("#btn");
const msg = document.querySelector("#msg");

async function toBase64(file){
  return new Promise((resolve,reject)=>{
    const reader=new FileReader();
    reader.onload=()=>{const [prefix,b64]=reader.result.split(",");resolve({base64:b64,mime:prefix.split(":")[1].split(";")[0]})};
    reader.onerror=()=>reject(reader.error);
    reader.readAsDataURL(file);
  });
}

async function loadJugadores(){
  msg.style.color = "#374151";
  try{
    const res=await fetch(WEB_APP_URL);
    const data=await res.json();
    let real = parseInt(data.total ?? 0, 10);
    if (isNaN(real)) real = 0;
    let total = BASE_CONTADOR + real;
    totalEl.textContent = total;
  }catch(e){
    msg.textContent="No se pudo cargar la lista.";
    msg.style.color = "#b91c1c";
    console.error(e);
  }
}

form.addEventListener("submit", async e=>{
  e.preventDefault();
  msg.textContent="";
  msg.style.color = "#374151";
  const nombre=document.querySelector("#nombre").value.trim();
  const file=document.querySelector("#foto").files[0];
  if(!nombre||!file){msg.textContent="Completa nombre y foto."; msg.style.color="#b91c1c"; return;}
  if(file.size>8*1024*1024){msg.textContent="La imagen debe pesar menos de 8 MB."; msg.style.color="#b91c1c"; return;}
  btn.disabled=true; btn.textContent="Enviando…";
  try{
    const {base64,mime}=await toBase64(file);
    const body=new URLSearchParams({nombre,foto:base64,mimetype:mime,filename:file.name});
    const res=await fetch(WEB_APP_URL,{
      method:"POST",
      headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},
      body
    });
    const out=await res.json();
    if(out.status==="success"){
      msg.style.color="#16a34a";msg.textContent="Jugador registrado con éxito.";
      form.reset();
      await loadJugadores();
    } else throw new Error(out.message||"Error desconocido");
  }catch(err){
    console.error(err);
    msg.style.color="#b91c1c";
    msg.textContent="Error al registrar: "+err.message;
  } finally{
    btn.disabled=false;btn.textContent="Registrar";
  }
});
loadJugadores();
</script>
</body>
</html>
